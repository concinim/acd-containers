"use strict";(self.webpackChunkacd_containers=self.webpackChunkacd_containers||[]).push([[5833],{3624:function(e,t,r){r.d(t,{Z:function(){return v}});var a=r(7294),o=r(8650),n=r.n(o),i=r(1597),s=r(3383),l=r(2618),c=r(5900),m=r.n(c),p=function(e){var t,r=e.title,o=e.theme,n=e.tabs,i=void 0===n?[]:n;return a.createElement("div",{className:m()("PageHeader-module--page-header--NqfPe",(t={},t["PageHeader-module--with-tabs--vbQ-W"]=i.length,t["PageHeader-module--dark-mode--WCeH8"]="dark"===o,t))},a.createElement("div",{className:"bx--grid"},a.createElement("div",{className:"bx--row"},a.createElement("div",{className:"bx--col-lg-12"},a.createElement("h1",{id:"page-title",className:"PageHeader-module--text--Er2EO"},r)))))},d=function(e){var t=e.relativePagePath,r=e.repository,o=(0,i.useStaticQuery)("1364590287").site.siteMetadata.repository,n=r||o,s=n.baseUrl,l=n.subDirectory,c=s+"/edit/"+n.branch+l+"/src/pages"+t;return s?a.createElement("div",{className:"bx--row EditLink-module--row--BEmSX"},a.createElement("div",{className:"bx--col"},a.createElement("a",{className:"EditLink-module--link--IDrl1",href:c},"Edit this page on GitHub"))):null},u=r(4703),g=r(1721),h=function(e){function t(){return e.apply(this,arguments)||this}return(0,g.Z)(t,e),t.prototype.render=function(){var e=this.props,t=e.title,r=e.tabs,o=e.slug,s=o.split("/").filter(Boolean).slice(-1)[0],l=r.map((function(e){var t,r=n()(e,{lower:!0,strict:!0}),l=r===s,c=new RegExp(s+"/?(#.*)?$"),p=o.replace(c,r);return a.createElement("li",{key:e,className:m()((t={},t["PageTabs-module--selected-item--aBB0K"]=l,t),"PageTabs-module--list-item--024o6")},a.createElement(i.Link,{className:"PageTabs-module--link--Kz-7R",to:""+p},e))}));return a.createElement("div",{className:"PageTabs-module--tabs-container--Cdfzw"},a.createElement("div",{className:"bx--grid"},a.createElement("div",{className:"bx--row"},a.createElement("div",{className:"bx--col-lg-12 bx--col-no-gutter"},a.createElement("nav",{"aria-label":t},a.createElement("ul",{className:"PageTabs-module--list--xLqxG"},l))))))},t}(a.Component),y=h,f=r(7296),k=r(5387),N=r(3732),b=function(e){var t=e.date,r=new Date(t);return t?a.createElement(N.X2,{className:"last-modified-date-module--row--XJoYQ"},a.createElement(N.sg,null,a.createElement("div",{className:"last-modified-date-module--text--ogPQF"},"Page last updated: ",r.toLocaleDateString("en-GB",{day:"2-digit",year:"numeric",month:"long"})))):null},v=function(e){var t=e.pageContext,r=e.children,o=e.location,c=e.Title,m=t.frontmatter,g=void 0===m?{}:m,h=t.relativePagePath,N=t.titleType,v=g.tabs,C=g.title,E=g.theme,w=g.description,P=g.keywords,x=g.date,D=(0,k.Z)().interiorTheme,S=(0,i.useStaticQuery)("2456312558").site.pathPrefix,A=S?o.pathname.replace(S,""):o.pathname,I=v?A.split("/").filter(Boolean).slice(-1)[0]||n()(v[0],{lower:!0}):"",T=E||D;return a.createElement(l.Z,{tabs:v,homepage:!1,theme:T,pageTitle:C,pageDescription:w,pageKeywords:P,titleType:N},a.createElement(p,{title:c?a.createElement(c,null):C,label:"label",tabs:v,theme:T}),v&&a.createElement(y,{title:C,slug:A,tabs:v,currentTab:I}),a.createElement(f.Z,{padded:!0},r,a.createElement(d,{relativePagePath:h}),a.createElement(b,{date:x})),a.createElement(u.Z,{pageContext:t,location:o,slug:A,tabs:v,currentTab:I}),a.createElement(s.Z,null))}},2136:function(e,t,r){r.r(t),r.d(t,{_frontmatter:function(){return s},default:function(){return m}});var a=r(3366),o=(r(7294),r(4983)),n=r(3624),i=["components"],s={},l={_frontmatter:s},c=n.Z;function m(e){var t=e.components,r=(0,a.Z)(e,i);return(0,o.kt)(c,Object.assign({},l,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Setting up container registry repository mirroring enables you to do the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Configure your OpenShift Container Platform cluster to redirect requests to pull images from a repository on a source image registry and have it resolved by a repository on a mirrored image registry."),(0,o.kt)("li",{parentName:"ul"},"Identify multiple mirrored repositories for each target repository, to make sure that if one mirror is down, another can be used.")),(0,o.kt)("p",null,"See Red Hat OpenShift’s ",(0,o.kt)("a",{parentName:"p",href:"https://docs.openshift.com/container-platform/4.8/openshift_images/image-configuration.html#images-configuration-registry-mirror_image-configuration"},"configuring image registry repository mirroring")," for additional details."),(0,o.kt)("p",null,"Images for IBM Watson Annotator for Clinical Data are available from the IBM Entitled Registry through December, 2022. Images for Merative Annotator for Clinical Data are available from the ACD registry. ACD consumers need to migrate from IBM ACD to Merative ACD by the end of December, 2022. To help ensure all ACD images are available during this migration period, we have mirrored recent ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/merative/acd-containers/blob/master/CHANGELOG.md#releases"},"versions")," of the IBM ACD images from the IBM Entitled Registry to the ACD registry. Credentials for the ACD registry can be used to pull either Merative or IBM ACD images, once mirroring is configured for the IBM ACD images."),(0,o.kt)("p",null,"In order to use mirrored images, follow these steps to configure container registry and repository image source and mirror locations on your cluster."),(0,o.kt)("h3",null,"Configure mirroring to an existing mirror location"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Log into the cluster"),(0,o.kt)("p",{parentName:"li"},"Log into the Red Hat OpenShift Container Platform cluster as a cluster administrator using the ",(0,o.kt)("inlineCode",{parentName:"p"},"oc login")," command.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create the ACD registry credentials for the Azure ACD registry, if not previously created. See ",(0,o.kt)("a",{parentName:"p",href:"/acd-containers/installing/installing/#ibm-entitled-registry-pull-secret"},"creating a global pull secret")," for details."),(0,o.kt)("p",{parentName:"li"},(0,o.kt)("strong",{parentName:"p"},"NOTE"),": You can only configure global pull secrets for clusters that have an ImageContentSourcePolicy object. You cannot add a pull secret to a project.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create an ",(0,o.kt)("inlineCode",{parentName:"p"},"ImageContentSourcePolicy")," file (for example, ",(0,o.kt)("inlineCode",{parentName:"p"},"acd-registry-mirror.yaml"),"), replacing the source and mirrors with your own registry and repository pairs and images if you don’t want to use the provided mirrors."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:"acd-registry-mirror.yaml","acd-registry-mirror.yaml":!0},"apiVersion: operator.openshift.io/v1alpha1\nkind: ImageContentSourcePolicy\nmetadata:\n  name: acd-registry-mirror\nspec:\n  repositoryDigestMirrors:\n    - mirrors:\n        - acdcontaineredition.azurecr.io/cp/wh-acd\n      source: cp.icr.io/cp/wh-acd\n    - mirrors:\n        - acdcontaineredition.azurecr.io/cp\n      source: icr.io/cpopen\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create the new ",(0,o.kt)("inlineCode",{parentName:"p"},"ImageContentSourcePolicy")," object."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"oc create -f acd-registry-mirrror.yaml\n")),(0,o.kt)("p",{parentName:"li"},"After the ",(0,o.kt)("inlineCode",{parentName:"p"},"ImageContentSourcePolicy")," object is created, the new settings are deployed to each node and the cluster starts using the mirrored repository for requests to the source repository.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Check that the mirrored configuration settings are applied by doing the following on one of the nodes."),(0,o.kt)("p",{parentName:"li"},"a. List your nodes:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"oc get node\n")),(0,o.kt)("p",{parentName:"li"},"Example output"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"NAME            STATUS                        ROLES           AGE\n10.240.128.19   Ready                         master,worker   56d\n10.240.128.20   NotReady,SchedulingDisabled   master,worker   56d\n10.240.128.21   Ready                         master,worker   56d\n10.240.128.5    Ready                         master,worker   25h\n10.240.128.6    Ready                         master,worker   25h\n10.240.128.7    Ready                         master,worker   25h\n")),(0,o.kt)("p",{parentName:"li"},"You can see that scheduling on each worker node is disabled as the change is being applied."),(0,o.kt)("p",{parentName:"li"},"b. Start the debugging process to access the node:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"oc debug node/10.240.128.20\n")),(0,o.kt)("p",{parentName:"li"},"Example output"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"Starting pod/1024012821-debug ...\nTo use host binaries, run `chroot /host`\nPod IP: 10.240.128.21\nIf you don't see a command prompt, try pressing enter.\nsh-4.4#\n")),(0,o.kt)("p",{parentName:"li"},"c. Access the node’s files:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"sh-4.4# chroot /host\nsh-4.2#\n")),(0,o.kt)("p",{parentName:"li"},"d. Check the ",(0,o.kt)("inlineCode",{parentName:"p"},"/etc/containers/registries.conf")," file to make sure the changes were made:"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"sh-4.2# cat /etc/containers/registries.conf\n")),(0,o.kt)("p",{parentName:"li"},"Example output"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},'unqualified-search-registries = ["registry.access.redhat.com", "docker.io"]\n\n[[registry]]\n  prefix = ""\n  location = "cp.icr.io/cp/wh-acd"\n  mirror-by-digest-only = true\n\n  [[registry.mirror]]\n    location = "acdcontaineredition.azurecr.io/cp/wh-acd"\n\n[[registry]]\n  prefix = ""\n  location = "icr.io/cpopen"\n  mirror-by-digest-only = true\n\n  [[registry.mirror]]\n    location = "acdcontaineredition.azurecr.io/cp"\n')),(0,o.kt)("p",{parentName:"li"},"e. Pull an image digest to the node from the source and check if it is resolved by the mirror. ",(0,o.kt)("inlineCode",{parentName:"p"},"ImageContentSourcePolicy")," objects support image digests only, not image tags."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre"},"podman pull --log-level=debug cp.icr.io/cp/wh-acd/clinical-data-annotator@sha256:bc077404849f4794a9de0ff2aad3a9af78fe72560b46d623a711d42927e5c955\n")))),(0,o.kt)("h3",null,"Mirror images to another container registry"),(0,o.kt)("p",null,"There are several ways that you can mirror images from one registry to another. Choose the most appropriate method for your environment. These documents may be useful as references."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Set up a mirrored repository with Red Hat Quay, as described in ",(0,o.kt)("a",{parentName:"li",href:"https://access.redhat.com/documentation/en-us/red_hat_quay/3/html/manage_red_hat_quay/repo-mirroring-in-red-hat-quay"},"Red Hat Quay Repository Mirroring"),". Using Red Hat Quay allows you to copy images from one repository to another and also automatically syncs those repositories repeatedly over time."),(0,o.kt)("li",{parentName:"ul"},"Use a tool such as skopeo (see example ",(0,o.kt)("a",{parentName:"li",href:"https://docs.openshift.com/container-platform/4.8/openshift_images/image-configuration.html#images-configuration-registry-mirror_image-configuration"},"here"),") to copy images manually from the source directory to the mirrored repository."),(0,o.kt)("li",{parentName:"ul"},"Set up a mirrored repository to a private container registry, as described ",(0,o.kt)("a",{parentName:"li",href:"https://www.ibm.com/docs/en/cloud-paks/cp-data/4.0?topic=tasks-mirroring-images-your-private-container-registry"},"here")," to mirror images from the IBM Entitled Registry.")))}m.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-installing-using-image-mirroring-md-539bd1c2b1bd51fed182.js.map